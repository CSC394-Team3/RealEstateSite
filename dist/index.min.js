"use strict";var express=require("express"),app=express(),bodyParser=require("body-parser"),port=process.env.PORT||3e3,router=express.Router(),path=require("path"),pg=require("pg"),bcrypt=require("bcrypt");app.use(express.static(path.join(__dirname,"public"))),app.set("view engine","pug");var addressID,current_username="",current_realtorID=2,realtor=!0;app.use(bodyParser.json()),app.use(express.json()),app.use(bodyParser.urlencoded({extended:!0}));var Pool=require("pg").Pool,connectionParams=null;connectionParams=null!=process.env.DATABASE_URL?{connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}}:{host:"willowrealestate.postgres.database.azure.com",user:"team5",password:"Willow5!",database:"postgres",port:5432,ssl:!0},console.log(connectionParams);var pool=new pg.Client(connectionParams);pool.connect(function(e){if(e)throw e}),router.get("/",function(e,r,o){r.render("index",{title:"Willow"})}),router.get("/insert",function(e,o){pool.query("SELECT * FROM property INNER JOIN address on address.addressID = property.addressID",function(e,r){console.log(e,r),o.render("insert",{properties:r.rows})})}),router.post("/insert",function(t,n){if(t.body.action&&"add"==t.body.action){var e="INSERT INTO address (street, city, state, zip) VALUES ( '".concat(t.body.street,"', '").concat(t.body.city,"', '").concat(t.body.state,"', '").concat(t.body.zip,"' ) ON conflict do nothing RETURNING addressID ");pool.query(e,function(e,r){if(0<r.rows.length){addressID=r.rows[0].addressid,console.log(e,r);var o="INSERT INTO property (propertyType, price, size, num_bedroom, num_bathroom,realtorID, addressID) VALUES ('".concat(t.body.propertytype,"', '").concat(t.body.price,"','").concat(t.body.size,"','").concat(t.body.num_bedroom,"','").concat(t.body.num_bathroom,"','").concat(current_realtorID,"', '").concat(addressID,"')");pool.query(o,function(e,r){console.log(e,r),n.redirect("/insert")})}})}if(t.body.action&&"update"==t.body.action){var r="UPDATE address SET street = '".concat(t.body.street,"', city = '").concat(t.body.city,"', state = '").concat(t.body.state,"', zip = '").concat(t.body.zip,"' RETURNING addressID");pool.query(r,function(e,r){if(e)n.send("Address Not Found");else{addressID=r.rows[0].addressID;var o="UPDATE property SET propertyType = '".concat(t.body.propertytype,"', price = '").concat(t.body.price,"', size='").concat(t.body.size,"', num_bedroom = '").concat(t.body.num_bedroom,"', num_bathroom = '").concat(t.body.num_bathroom,"' WHERE addressID = '").concat(addressID,"'");pool.query(o,function(e,r){console.log(e,r),n.redirect("/insert")})}})}t.body.action&&"delete"==t.body.action&&pool.query("DELETE FROM property WHERE addressID = '".concat(addressID,"'"),function(e,r){console.log(e,r),n.redirect("/insert")})}),router.get("/register",function(e,r){r.render("register")}),router.post("/register",function(e,r){e.body.action&&"customer"==e.body.action&&(realtor=!1,r.redirect("/customersignup")),e.body.action&&"realtor"==e.body.action&&(realtor=!0,r.redirect("/realtorsignup"))}),router.get("/customersignup",function(e,r){r.render("customersignup")}),router.post("/customersignup",function(o,t){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(o.body.username&&o.body.password&&o.body.firstName&&o.body.lastName&&o.body.phoneno&&o.body.email){e.next=4;break}t.redirect("/customersignuperror"),e.next=8;break;case 4:return e.next=6,regeneratorRuntime.awrap(bcrypt.hash(o.body.password,10));case 6:r=e.sent,pool.query("INSERT INTO customer(user_name,password,first_name,last_name,phone_number,email)\n\t\tVALUES ( '".concat(o.body.username,"', '").concat(r,"', '").concat(o.body.firstName,"', '").concat(o.body.lastName,"', '").concat(o.body.phoneno,"', '").concat(o.body.email,"' ) "),function(e,r){current_username=o.body.username,t.redirect("/customerlogin")});case 8:case"end":return e.stop()}})}),router.get("/customersignuperror",function(e,r){r.render("customersignuperror")}),router.post("/customersignuperror",function(e,r){e.body.action&&"try again"==e.body.action&&r.redirect("/customersignup")}),router.get("/realtorsignup",function(e,r){r.render("realtorsignup")}),router.post("/realtorsignup",function(o,t){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(o.body.realtorID&&o.body.username&&o.body.password&&o.body.agency&&o.body.firstName&&o.body.lastName&&o.body.phoneno&&o.body.email){e.next=2;break}return e.abrupt("return",t.redirect("/realtorsignuperror"));case 2:return e.next=4,regeneratorRuntime.awrap(bcrypt.hash(o.body.password,10));case 4:r=e.sent,pool.query("INSERT INTO realtor(realtorID, user_name,password, agency, first_name,last_name,phone_number,email)\n\t\tVALUES ( '".concat(o.body.realtorID,"' ,'").concat(o.body.username,"', '").concat(r,"', '").concat(o.body.agency,"','").concat(o.body.firstName,"', '").concat(o.body.lastName,"', '").concat(o.body.phoneno,"', '").concat(o.body.email,"' ) \n\t "),function(e,r){current_realtorID=o.body.realtorID,current_username=o.body.username,t.redirect("/realtorlogin")});case 6:case"end":return e.stop()}})}),router.get("/realtorsignuperror",function(e,r){r.render("realtorsignuperror")}),router.post("/realtorsignuperror",function(e,r){e.body.action&&"try again"==e.body.action&&r.redirect("/realtorsignup")}),router.get("/invalid",function(e,r){r.render("invalidlogin")}),router.post("/invalid",function(e,r){realtor?r.redirect("/realtorlogin"):r.redirect("/customerlogin")}),router.get("/login",function(e,r){r.render("index")}),router.post("/login",function(e,r){e.body.action&&"customer"==e.body.action&&r.redirect("/customerlogin"),e.body.action&&"realtor"==e.body.action&&r.redirect("/realtorlogin")}),router.get("/customerlogin",function(e,r){r.render("customerlogin")}),router.post("/customerlogin",function(t,n){realtor=!1,t.body.action&&"login"==t.body.action&&(current_username=t.body.username,pool.query("SELECT * FROM CUSTOMER WHERE user_name = '".concat(t.body.username,"'"),function(e,r){if(console.log(e,r),0==r.rows.length&&n.redirect("/nocustomer"),0<r.rows.length){var o=r.rows[0].password;bcrypt.compareSync(t.body.password,o)?n.redirect("/customerpanel"):(n.redirect("/invalid"),console.log(t))}})),t.body.action&&"register"==t.body.action&&n.redirect("/register")}),router.get("/nocustomer",function(e,r){r.render("nocustomer")}),router.post("/nocustomer",function(e,r){e.body.action&&"try again"==e.body.action&&r.redirect("/customerlogin"),e.body.action&&"register"==e.body.action&&r.redirect("/customersignup")}),router.get("/norealtor",function(e,r){r.render("norealtor")}),router.post("/norealtor",function(e,r){e.body.action&&"try again"==e.body.action&&r.redirect("/realtorlogin"),e.body.action&&"register"==e.body.action&&r.redirect("/realtorsignup")}),router.get("/realtorlogin",function(e,r){r.render("realtorlogin")}),router.post("/realtorlogin",function(t,n){realtor=!0,t.body.action&&"login"==t.body.action&&(current_username=t.body.username,pool.query("SELECT * FROM realtor WHERE user_name = '".concat(t.body.username,"'"),function(e,r){if(console.log(e,r),0==r.rows.length&&n.redirect("/norealtor"),0<r.rows.length){var o=r.rows[0].password;bcrypt.compareSync(t.body.password,o)?(current_realtorID=r.rows[0].realtorID,n.redirect("/realtorpanel")):(n.redirect("/invalid"),console.log(t))}})),t.body.action&&"register"==t.body.action&&n.redirect("/register")}),router.get("/realtorpanel",function(e,o){pool.query("SELECT * FROM realtor WHERE user_name = '".concat(current_username,"'"),function(e,r){console.log(e,r),o.render("realtorpanel",{name:current_username,realtor:r.rows[0]})})}),router.post("/realtorpanel",function(e,r){e.body.action&&"crud"==e.body.action&&r.redirect("/insert"),e.body.action&&"change password"==e.body.action&&r.redirect("/realtorchangepassword"),e.body.action&&"change password"==e.body.action&&r.redirect("/realtorchangephoneno"),e.body.action&&"change email"==e.body.action&&r.redirect("/realtorchangeemail"),e.body.action&&"change agency"==e.body.action&&r.redirect("/realtorchangeagency"),e.body.action&&"change phone number"==e.body.action&&r.redirect("/realtorchangephoneno"),e.body.action&&"go to listings"==e.body.action&&r.redirect("/listingsr")}),router.get("/listingsr",function(e,r){r.render("listingsr")}),router.post("/listingsr",function(e,r){}),router.get("/realtorchangeagency",function(e,r){r.render("realtorchangeagency")}),router.post("/realtorchangeagency",function(e,r){pool.query("UPDATE realtor SET agency = '".concat(e.body.agency,"' WHERE user_name = '").concat(current_username,"' ")),r.redirect("/realtorpanel")}),router.get("/realtorchangepassword",function(e,r){r.render("realtorchangepassword")}),router.post("/realtorchangepassword",function(e,r){pool.query("UPDATE realtor SET password = '".concat(e.body.password,"' WHERE user_name = '").concat(current_username,"' ")),r.redirect("/realtorpanel")}),router.get("/realtorchangeemail",function(e,r){r.render("realtorchangeemail")}),router.post("/realtorchangeemail",function(e,r){pool.query("UPDATE realtor SET email = '".concat(e.body.email,"' WHERE user_name = '").concat(current_username,"' ")),r.redirect("/realtorpanel")}),router.get("/realtorchangephoneno",function(e,r){r.render("realtorchangephoneno")}),router.post("/realtorchangephoneno",function(e,r){pool.query("UPDATE realtor SET phone_number = '".concat(e.body.phoneno,"' WHERE user_name = '").concat(current_username,"' ")),r.redirect("/realtorpanel")}),router.get("/customerpanel",function(e,o){pool.query("SELECT * FROM customer WHERE user_name = '".concat(current_username,"'"),function(e,r){console.log(e,r),o.render("customerpanel",{name:current_username,customer:r.rows[0]})})}),router.post("/customerpanel",function(e,r){e.body.action&&"change password"==e.body.action&&r.redirect("/customerchangepassword"),e.body.action&&"change password"==e.body.action&&r.redirect("/customerchangephoneno"),e.body.action&&"change email"==e.body.action&&r.redirect("/customerchangeemail"),e.body.action&&"change phone number"==e.body.action&&r.redirect("/customerchangephoneno"),e.body.action&&"go to listings"==e.body.action&&r.redirect("/listingsc")}),router.get("/listingsc",function(e,r){r.render("listingsc")}),router.post("/listingsc",function(e,r){}),router.get("/customerchangepassword",function(e,r){r.render("customerchangepassword")}),router.post("/customerchangepassword",function(e,r){pool.query("UPDATE customer SET password = '".concat(e.body.password,"' WHERE user_name = '").concat(current_username,"' ")),r.redirect("/customerpanel")}),router.get("/customerchangeemail",function(e,r){r.render("customerchangeemail")}),router.post("/customerchangeemail",function(e,r){pool.query("UPDATE customer SET email = '".concat(e.body.email,"' WHERE user_name = '").concat(current_username,"' ")),r.redirect("/customerpanel")}),router.get("/customerchangephoneno",function(e,r){r.render("customerchangephoneno")}),router.post("/customerchangephoneno",function(e,r){pool.query("UPDATE customer SET phone_number = '".concat(e.body.phoneno,"' WHERE user_name = '").concat(current_username,"' ")),r.redirect("/customerpanel")}),app.use("/",router),app.listen(port,function(){console.log("Example app listening on port ".concat(port))});
//# sourceMappingURL=index.min.js.map
